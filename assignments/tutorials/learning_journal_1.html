<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Learning Journal: Step 1 &mdash; Python 401 2.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python 401 2.1 documentation" href="../../index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />

<link rel="stylesheet" href="../../_static/custom.css" type="text/css" media="screen" charset="utf-8" />

<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../../index.html">
      <img class="logo" src="../../_static/cf_logo.png" alt="Logo"/>
      <p>Code Fellows</p>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="python-learning-journal-step-1">
<h1>Python Learning Journal: Step 1<a class="headerlink" href="#python-learning-journal-step-1" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will begin the process of creating an online learning
journal using Python and the <a class="reference external" href="http://www.pylonsproject.org">Pyramid web framework</a>.</p>
<p>The walk-through is intended to get you to a working application as quickly as
possible. There will be many questions left unanswered as we proceed. Fear not.
The answers will come as this course progresses. For now, simply focus on the
process and getting to a working application.</p>
<p>Our application will be built using a <a class="reference external" href="http://www.tomdalling.com/blog/software-design/model-view-controller-explained/">Model-View-Controller</a> <a class="reference external" href="http://blog.codinghorror.com/understanding-model-view-controller/">pattern</a> where
each component in our design falls into one of those three categories.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>In order to follow this tutorial, you will need to have several tools in place before you begin.</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://www.python.org/download/">Python 2.7.x</a></li>
<li>Virtualenv installed and properly configured</li>
<li>The <a class="reference external" href="https://www.codefellows.org/blogs/how-to-install-postgresql">PostgreSQL Database Engine</a> installed and properly configured</li>
<li>A c compiler and Python development headers</li>
<li>An account with <a class="reference external" href="https://github.com">GitHub</a></li>
<li>An account with <a class="reference external" href="https://heroku.com">Heroku</a> (and the heroku toolbelt installed)</li>
</ol>
</div>
<div class="section" id="create-your-environment">
<h2>Create Your Environment<a class="headerlink" href="#create-your-environment" title="Permalink to this headline">¶</a></h2>
<p>If all the pieces are in place, you are ready to proceed to the next level.</p>
<div class="section" id="set-up-the-project-environment">
<h3>Set Up the Project Environment<a class="headerlink" href="#set-up-the-project-environment" title="Permalink to this headline">¶</a></h3>
<p>Since you&#8217;ve installed and configured <code class="docutils literal"><span class="pre">virtualenv</span></code> and properly, this step is simple.
Open a command shell and type the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>$ mkproject learning-journal
</pre></div>
</div>
<p>You should see output that looks like this (though your prompt and path names will look different):</p>
<div class="highlight-bash"><div class="highlight"><pre>192:~ cewing$ mkproject learning-journal
New python executable in learning-journal/bin/python
Installing setuptools, pip...done.
Creating /Users/cewing/projects/learning-journal
Setting project <span class="k">for</span> learning-journal to /Users/cewing/projects/learning-journal
<span class="o">[</span>learning-journal<span class="o">]</span>
192:learning-journal cewing$
</pre></div>
</div>
<p>This command will do a couple of things for you:</p>
<ul class="simple">
<li>create a new Python virtual environment called <code class="docutils literal"><span class="pre">learning-journal</span></code> in your
configured <code class="docutils literal"><span class="pre">$WORKON_HOME</span></code></li>
<li>install <code class="docutils literal"><span class="pre">pip</span></code> and <code class="docutils literal"><span class="pre">setuptools</span></code> in the new environment</li>
<li>activate the new environment</li>
<li>create a new project directory called <code class="docutils literal"><span class="pre">learning-journal</span></code> in your configured
<code class="docutils literal"><span class="pre">$PROJECT_HOME</span></code></li>
<li>change your current working directory to the new project directory</li>
</ul>
<p>Now you have a clean and isolated environment in which to do your work.</p>
</div>
<div class="section" id="create-a-github-project-repository">
<h3>Create a GitHub Project Repository<a class="headerlink" href="#create-a-github-project-repository" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;ve already created a <code class="docutils literal"><span class="pre">learning-journal</span></code> repository for your
learning journal mockup assignment, you can use that repository instead of
creating a new one. Skip to
<a class="reference internal" href="#clone-repo"><span>Clone Your Repository</span></a></p>
</div>
<p>Open a web browser and go to <a class="reference external" href="https://github.com">GitHub</a>. If you are not logged in, do so.</p>
<p>At the top left, find the small <code class="docutils literal"><span class="pre">+</span></code> icon next to your name and click it.
Select <strong>New Repository</strong> from the drop-down menu.</p>
<p>A form will load, allowing you to enter some information about your new
repository.</p>
<a class="reference internal image-reference" href="../../_images/learning_journal_repo_setup.png"><img alt="../../_images/learning_journal_repo_setup.png" src="../../_images/learning_journal_repo_setup.png" style="width: 90%;" /></a>
<p>Enter the following values:</p>
<dl class="docutils">
<dt>Repository Name:</dt>
<dd><code class="docutils literal"><span class="pre">learning-journal</span></code></dd>
<dt>Description:</dt>
<dd>A lightweight Pyramid web journal.</dd>
</dl>
<p>Leave the new repository as <strong>Public</strong></p>
<p>Check the box for initializing the repository with a README.</p>
<p>Select a Python <code class="docutils literal"><span class="pre">.gitignore</span></code> file from the first drop-down at the bottom.</p>
<p>Choose a reasonable license from the second drop-down (I used MIT).</p>
<p>Finally, click the <strong>Create Repository</strong> button.</p>
</div>
<div class="section" id="clone-your-repository">
<span id="clone-repo"></span><h3>Clone Your Repository<a class="headerlink" href="#clone-your-repository" title="Permalink to this headline">¶</a></h3>
<p>Now that you have a repository for the application you will be writing, you&#8217;ll
want to get a copy of that code to your local machine.</p>
<p>On <code class="docutils literal"><span class="pre">GitHub</span></code>, while looking at your newly created repository, find the URL for
cloning your repository at the bottom of the menu on the right-hand side of the
page.</p>
<a class="reference internal image-reference" href="../../_images/learning_journal_clone_url.png"><img alt="../../_images/learning_journal_clone_url.png" src="../../_images/learning_journal_clone_url.png" style="width: 35%;" /></a>
<p>There are two versions of this URL, one for HTTPS and the other for SSH.</p>
<p>If you have <a class="reference external" href="https://help.github.com/articles/generating-ssh-keys">set up public key authentication</a> for your GitHub account (and
you really, really should), you will want to copy the SSH version of the URL.
Otherwise, you&#8217;ll need to copy the HTTPS version.</p>
<p>Back in your terminal, make sure you are in your <code class="docutils literal"><span class="pre">learning-journal</span></code> project
directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>192:learning-journal cewing$ <span class="nb">pwd</span>
/Users/cewing/projects/learning-journal
<span class="o">[</span>learning-journal<span class="o">]</span>
192:learning-journal cewing$
</pre></div>
</div>
<p>Then, use the <code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span></code> command to make a local copy of your new repository
(<strong>do not forget</strong> the final <code class="docutils literal"><span class="pre">./</span></code>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
192:learning-journal cewing$ git clone &lt;paste-your-copied-github-url-here&gt; ./
</pre></div>
</div>
<p>Once that is complete, you should have the contents of your github
<code class="docutils literal"><span class="pre">learning-journal</span></code> repository inside the directory you created earlier.  Your
filesystem should look something like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
heffalump:learning-journal cewing$ tree -a -I .git .
.
├── .gitignore
├── LICENSE
└── README.md
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you&#8217;ve already created content in your repository for your learning
journal mockup, you should also see that content in a <code class="docutils literal"><span class="pre">mockups</span></code> folder:</p>
<div class="last highlight-bash"><div class="highlight"><pre>.
├── .gitignore
├── LICENSE
├── README.md
└── mockups
    ├── create.html
    ├── detail.html
    ├── edit.html
    └── index.html
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-a-branch-for-today-s-work">
<h3>Create a Branch for Today&#8217;s Work<a class="headerlink" href="#create-a-branch-for-today-s-work" title="Permalink to this headline">¶</a></h3>
<p>We want to maintain a clean <code class="docutils literal"><span class="pre">master</span></code> branch in our repository.  Any work you
do on adding features to a project should be done on a branch, evaluated and
tested there, and only merged to master once the work is complete.</p>
<p>To create a branch called <code class="docutils literal"><span class="pre">step1</span></code> for todays work, follow these steps:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ git branch
* master
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ git checkout -b step1
Switched to a new branch <span class="s1">&#39;step1&#39;</span>
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ git branch
  master
* step1
</pre></div>
</div>
<p>You have created and checked out a new branch called <code class="docutils literal"><span class="pre">step1</span></code>. You&#8217;ll do your
day&#8217;s work here.</p>
<p>This new branch exists only on your local machine. When you finish today&#8217;s
assignment you&#8217;ll need to push this branch up to your GitHub repository. More
on that later.</p>
</div>
<div class="section" id="install-required-software">
<h3>Install Required Software<a class="headerlink" href="#install-required-software" title="Permalink to this headline">¶</a></h3>
<p>Before we begin, we&#8217;ll need to install some Python packages to get the tools
we&#8217;ll need to complete our project.</p>
<p>Make sure that your <code class="docutils literal"><span class="pre">learning-journal</span></code> virtual environment is active, and
that the <code class="docutils literal"><span class="pre">pip</span></code> command points to that environment (note the
<code class="docutils literal"><span class="pre">learning-journal</span></code> in the pathname below):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
192:learning-journal cewing$ which pip
/Users/cewing/virtualenvs/learning-journal/bin/pip
</pre></div>
</div>
<p>Using the <code class="docutils literal"><span class="pre">pip</span></code> command, install the required software as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
192:learning-journal cewing$ pip install pyramid psycopg2 waitress sqlalchemy zope.sqlalchemy pyramid-tm
Downloading/unpacking pyramid
...
Successfully installed pyramid psycopg2 zope.interface translationstring PasteDeploy WebOb repoze.lru zope.deprecation venusian waitress
Cleaning up...
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you are using Mac OS X you may see an error when installing Python code with
C extensions (like <code class="docutils literal"><span class="pre">psycopg2</span></code>):</p>
<div class="highlight-bash"><div class="highlight"><pre>clang: error: unknown argument: <span class="s1">&#39;-mno-fused-madd&#39;</span> <span class="o">[</span>-Wunused-command-line-argument-hard-error-in-future<span class="o">]</span>
</pre></div>
</div>
<p class="last">If you see this, you may need to <a class="reference external" href="http://stackoverflow.com/questions/22313407/clang-error-unknown-argument-mno-fused-madd-python-package-installation-fa">follow the instructions here</a> due to a
issue in how the OS X command-line c compiler is configured.</p>
</div>
</div>
<div class="section" id="preserve-your-installed-dependencies">
<h3>Preserve Your Installed Dependencies<a class="headerlink" href="#preserve-your-installed-dependencies" title="Permalink to this headline">¶</a></h3>
<p>In order to make it easier to work with others, you want to create a record of
the additional packages you&#8217;ve installed.  You&#8217;ll use <code class="docutils literal"><span class="pre">pip</span></code> to do that:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ pip freeze &gt; requirements.txt
</pre></div>
</div>
<p>Add that new file to your repository on this branch and commit the changes
locally:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ git add requirements.txt
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ git commit -m <span class="s2">&quot;add a requirements file&quot;</span>
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ git status
On branch step1
nothing to commit, working directory clean
</pre></div>
</div>
<p>After creating this new file, you&#8217;re file system layout should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>.
├── .gitignore
├── LICENSE
├── README.md
└── requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="create-a-database">
<h3>Create a Database<a class="headerlink" href="#create-a-database" title="Permalink to this headline">¶</a></h3>
<p>Finally, in order to preserve the journal entries you&#8217;ll write throughout the
class, you&#8217;ll need to have a database. You can use the <code class="docutils literal"><span class="pre">createdb</span></code> command
provided by <code class="docutils literal"><span class="pre">PostgreSQL</span></code> to accomplish this task. For development purposes it
is fine for you to own the database yourself.</p>
<p>Make sure that your database engine is running and then issue the following
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:projects cewing$ createdb learning-journal
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-the-data-layer">
<h2>Building the Data Layer<a class="headerlink" href="#building-the-data-layer" title="Permalink to this headline">¶</a></h2>
<p>You&#8217;ll start your learning journal by building the data layer.  This layer of
the application will be responsible for persisting entries to and retrieving
entries from the database you just created.</p>
<p>First, though, you&#8217;ll set up a simple working Pyramid application so you can
see something happen when you deploy later in the tutorial.</p>
<div class="section" id="the-app-skeleton">
<h3>The App Skeleton<a class="headerlink" href="#the-app-skeleton" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ll need to set up a basic Pyramid app skeleton to work from. Most Pyramid
tutorials you&#8217;ll see start by creating the app skeleton from a <em>scaffold</em>.  We
are going to build our first one by hand.  This will allow us to keep it nice
and simple.</p>
<p>In the root of your repository, create a file called <code class="docutils literal"><span class="pre">journal.py</span></code>, and add
the following:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>
<span class="kn">from</span> <span class="nn">waitress</span> <span class="kn">import</span> <span class="n">serve</span>


<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello World&quot;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create a configured wsgi app&quot;&quot;&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;reload_all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">debug</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;debug_all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">debug</span>
    <span class="c1"># configuration setup</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span>
        <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">app</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
    <span class="n">serve</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt>Lines 1-6:</dt>
<dd>import the required parts to make this all work.</dd>
<dt>Lines 9-11:</dt>
<dd>configure a simple home page view (more about this tomorrow)</dd>
<dt>Lines 14-27:</dt>
<dd>create a <strong>factory function</strong> that will build and return a basic application</dd>
<dt>Lines 30-33:</dt>
<dd>make <code class="docutils literal"><span class="pre">journal.py</span></code> a Python script that uses your factory to build an app
and then serves it.</dd>
</dl>
<p>At this point, you actually have a functional Pyramid app. In your terminal,
with the virtualenv active, type the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
Banks:learning-journal cewing$ python journal.py
serving on http://0.0.0.0:5000
</pre></div>
</div>
<p>Fire up a browser, and you should be able to see &#8220;Hello World&#8221; when you load
the url <a class="reference external" href="http://localhost:5000">http://localhost:5000</a>. You&#8217;ll fix this to look more interesting
tomorrow, but for now, bask in the glory of working code! Then quit the server
with <code class="docutils literal"><span class="pre">ctrl-C</span></code> to get back to a command prompt.</p>
</div>
<div class="section" id="the-entries-table">
<h3>The <code class="docutils literal"><span class="pre">entries</span></code> Table<a class="headerlink" href="#the-entries-table" title="Permalink to this headline">¶</a></h3>
<p>Your application is going to be a journal where you can write daily entries
about the things you learn here at Code Fellows. So what should one of these
<em>entries</em> look like? Let&#8217;s keep it simple for now. Each entry should have a
title, some text, and a value indicating the date and time it was created.
Perhaps an SQL schema definition for such an entry might look like this:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">entries</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">serial</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">title</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nb">text</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">created</span> <span class="k">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This defines a single database table called <code class="docutils literal"><span class="pre">entries</span></code> that has four columns.
There will be a primary key, a title and some text, and a <code class="docutils literal"><span class="pre">created</span></code> column
that will hold a timestamp.</p>
<p>As you learned in your readings and in class, you can create a database table
like this and then address it using the <code class="docutils literal"><span class="pre">psycopg2</span></code> library directly. That
works fine, but a more common pattern is to use an ORM (or Object-Relational
Mapper) to handle communications between your Python code and your database.</p>
<p>Using an ORM allows you define your database tables in terms of Python classes.
Creating instances of these classes and saving them writes records into the
database, and retrieving those records from the database gives you Python
object instances. These classes are generally called <code class="docutils literal"><span class="pre">Models</span></code>.</p>
<p>In order to work with an ORM a bit of configuration is required. You&#8217;ll need to
update your app skeleton to provide the infrastructure a model needs to work
properly.</p>
<p>In the imports at the top of your <code class="docutils literal"><span class="pre">journal.py</span></code> file, add the following
imports:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="kn">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
</pre></div>
</div>
<p>Then, just below the imports, set up a base class from which your model will
inherit. Remember, this base class provides the wiring that connects your model
to the database. It&#8217;s very important.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</pre></div>
</div>
<p>In class you created a very simple ORM model. See if you can repeat the
exercise for your journal entry model. Add the class definition just below the
<code class="docutils literal"><span class="pre">Base</span></code> class you created above. Call the model class <code class="docutils literal"><span class="pre">Entry</span></code>. Remember the
important requirements of this class:</p>
<ul class="simple">
<li>Your model <em>must</em> inherit from the <code class="docutils literal"><span class="pre">Base</span></code> class you just created.</li>
<li>Each persistent attribute of your entry (the bits you want to save) should be
an instance of the <code class="docutils literal"><span class="pre">sa.Column</span></code> class.</li>
<li>The database table for your entry should be called <code class="docutils literal"><span class="pre">entries</span></code>.</li>
</ul>
<p>Try to create this class on your own.  If you find after 20-30 minutes that you
are struggling, and you&#8217;ve tried looking up examples in the documentation, take
a peek at my solution below.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock8'))">Peek At A Solution</a><br /><div id="hiddencodeblock8" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># add this import at the top:</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="c1"># and define your class below the Base</span>
<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;entries&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">127</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">sa</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span>
    <span class="p">)</span>
</pre></div>
</div>
</div><p>Now you have a Python class that represents a journal entry. Because it is an
<code class="docutils literal"><span class="pre">ORM</span> <span class="pre">model</span></code>, it will be able to persist itself into a database, and you&#8217;ll be
able to retrieve it later to read or edit.</p>
<p>Before you move on, add your changes to git and commit them with a good message
about what you&#8217;ve done.</p>
</div>
<div class="section" id="initializing-the-db">
<h3>Initializing the DB<a class="headerlink" href="#initializing-the-db" title="Permalink to this headline">¶</a></h3>
<p>There&#8217;s still a missing ingredient here. You&#8217;ve created a database, but you
haven&#8217;t actually set up the <code class="docutils literal"><span class="pre">entries</span></code> table in that database. You&#8217;ll want to
set up some code that will do this for you. Next, add a function that will
create the database table that belongs to this new model you created.</p>
<p>Do you remember how you did that in class?  You used the <code class="docutils literal"><span class="pre">.create_all()</span></code>
method of the <code class="docutils literal"><span class="pre">declarative_base</span></code> class that was the parent class of the model
you wrote. You had to pass a connection to the database in to that function as
the <code class="docutils literal"><span class="pre">engine</span></code> parameter. Your job is to write a function that can accomplish
the same goal. Call the function <code class="docutils literal"><span class="pre">init_db</span></code> and you&#8217;ll place it just below
your <code class="docutils literal"><span class="pre">Entry</span></code> model definition in <code class="docutils literal"><span class="pre">journal.py</span></code>.</p>
<p>Review the <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_1_0/orm/tutorial.html">SQLAlchemy ORM Tutorial</a> and see if you can figure out how to write
this function on your own. One clue.  In the tutorial, you used the
<code class="docutils literal"><span class="pre">create_engine</span></code> method to make that connection.  If you can&#8217;t come up with
the right code within about 20-30 minutes, go ahead and take a peek at my
solution below.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock9'))">Peek At A Solution</a><br /><div id="hiddencodeblock9" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># make a module-level constant for the connection URI (you&#39;ll need it elsewhere):</span>
<span class="n">DATABASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;postgresql://&lt;username&gt;:&lt;password&gt;@localhost:5432/learning-journal&#39;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="n">DATABASE_URL</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div><p>Once you&#8217;ve got this method written, you can actually go ahead and create the
table in real life.</p>
<p>Start by firing up a postgresql connection in a new terminal window:</p>
<div class="highlight-bash"><div class="highlight"><pre>$ psql -U &lt;username&gt; learning-journal
</pre></div>
</div>
<p>If you need a password, postgresql will prompt you for one. Once connected,
list the tables in your database with the <code class="docutils literal"><span class="pre">\d</span></code> command:</p>
<div class="highlight-psql"><div class="highlight"><pre><span class="gp">learning-journal=#</span> <span class="kp">\d</span>
<span class="go">No relations found.</span>
</pre></div>
</div>
<p>You should see that there are no <em>relations</em> (postgresql&#8217;s fancy work for
table-like constructs).  That&#8217;s expected, since you haven&#8217;t run your function
yet.</p>
<p>Back in your terminal where the learning-journal virtualenv is active, start up
python, import your new function and run it:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">journal</span> <span class="kn">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
</pre></div>
</div>
<p>Then return to your postgresql terminal and try listing the tables again:</p>
<div class="highlight-psql"><div class="highlight"><pre><span class="gp">learning-journal=#</span> <span class="kp">\d</span>
<span class="go">              List of relations</span>
<span class="go"> Schema |      Name      |   Type   | Owner</span>
<span class="go">--------+----------------+----------+--------</span>
<span class="go"> public | entries        | table    | cewing</span>
<span class="go"> public | entries_id_seq | sequence | cewing</span>
<span class="go">(2 rows)</span>
</pre></div>
</div>
<p>Keen!</p>
<p>You can provide a table name argument to that command to see the information
about the <code class="docutils literal"><span class="pre">entries</span></code> table</p>
<div class="highlight-psql"><div class="highlight"><pre><span class="gp">learning-journal=#</span> <span class="kp">\d</span> <span class="ss">entries</span>
<span class="go">                                    Table &quot;public.entries&quot;</span>
<span class="go"> Column  |            Type             |                      Modifiers</span>
<span class="go">---------+-----------------------------+------------------------------------------------------</span>
<span class="go"> id      | integer                     | not null default nextval(&#39;entries_id_seq&#39;::regclass)</span>
<span class="go"> title   | character varying(127)      | not null</span>
<span class="go"> text    | text                        | not null</span>
<span class="go"> created | timestamp without time zone | not null</span>
<span class="go">Indexes:</span>
<span class="go">    &quot;entries_pkey&quot; PRIMARY KEY, btree (id)</span>
</pre></div>
</div>
<p>If your results look more-or-less like this, then you&#8217;ve succeeded. Now it is
time to connect this app to Heroku.</p>
<p>Before you move along, make sure you&#8217;ve added these changes to git and
committed them. Write a good message about what you&#8217;ve changed.</p>
</div>
</div>
<div class="section" id="app-deployment">
<h2>App Deployment<a class="headerlink" href="#app-deployment" title="Permalink to this headline">¶</a></h2>
<p>You are going to put your learning journal online using <a class="reference external" href="https://heroku.com">Heroku</a>, a service
that simplifies deploying web applications in a number of languages.</p>
<p>Moving on from here assumes that you have already created a Heroku account,
downloaded and installed the toolbelt, and successfully logged in to Heroku
from your command line. If that is not the case. Please <a class="reference external" href="https://devcenter.heroku.com/articles/quickstart">follow this tutorial</a>
to get up to speed. You only need to do the first two steps (Introduction and
Set up)</p>
<div class="section" id="add-a-procfile">
<h3>Add a Procfile<a class="headerlink" href="#add-a-procfile" title="Permalink to this headline">¶</a></h3>
<p>Heroku uses a standard file to control how your app is built and served. This
file <strong>must</strong> be named <code class="docutils literal"><span class="pre">Procfile</span></code> (and capitalization counts). Go ahead and
create a new file by that name in your journal repository root.</p>
<p>Now your filesystem should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>learning-journal
└── learning-journal
    ├── .gitignore
    ├── LICENSE
    ├── Procfile
    ├── README.md
    ├── journal.py
    └── requirements.txt
</pre></div>
</div>
<p>In your new <code class="docutils literal"><span class="pre">Procfile</span></code>, type the following line of code:</p>
<div class="highlight-text"><div class="highlight"><pre>web: python journal.py
</pre></div>
</div>
<p>This tells heroku that you will be running a <code class="docutils literal"><span class="pre">web</span></code> service and that the
service will be provided by executing the <code class="docutils literal"><span class="pre">python</span> <span class="pre">journal.py</span></code>.</p>
<p>Once you&#8217;ve got that created, you should be able to use <code class="docutils literal"><span class="pre">foreman</span></code>, provided
by the Heroku Toolbelt, to start up your application:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ foreman start
23:26:33 web.1  <span class="p">|</span> started with pid 68019
</pre></div>
</div>
<p>With that process running in your terminal, start up your web browser and load
<code class="docutils literal"><span class="pre">http://127.0.0.1:5000</span></code>.  You should be able to see this:</p>
<a class="reference internal image-reference" href="../../_images/learning_journal_helloworld.png"><img alt="../../_images/learning_journal_helloworld.png" src="../../_images/learning_journal_helloworld.png" style="width: 90%;" /></a>
<p>If you do, then your <code class="docutils literal"><span class="pre">Procfile</span></code> is correct, and you are ready to go.</p>
<p>Before you move on, add your changes to git and commit them.  Include a good
message about what you&#8217;ve changed.</p>
</div>
<div class="section" id="submit-a-pull-request">
<h3>Submit a Pull Request<a class="headerlink" href="#submit-a-pull-request" title="Permalink to this headline">¶</a></h3>
<p>For the class submission process, you will use GitHub pull requests. This
allows your instructors and TAs to easily find the work you did for any given
assignment.</p>
<p>Before you can make a pull request, you must first push the branch you created
for this assignment up to GitHub.  In your terminal, from inside your
<code class="docutils literal"><span class="pre">learning-journal</span></code> repository, take the following steps:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>step1<span class="o">]</span>
192:learning-journal cewing$ git push -u origin step1
Counting objects: 32, <span class="k">done</span>.
Delta compression using up to <span class="m">8</span> threads.
Compressing objects: 100% <span class="o">(</span>23/23<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>23/23<span class="o">)</span>, 3.41 KiB <span class="p">|</span> <span class="m">0</span> bytes/s, <span class="k">done</span>.
Total <span class="m">23</span> <span class="o">(</span>delta 14<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>
To git@github.com:cewing/learning-journal.git
 * <span class="o">[</span>new branch<span class="o">]</span>      step1 -&gt; step1
Branch step1 <span class="nb">set</span> up to track remote branch step1 from origin.
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">step1</span><span class="o">=]</span>
192:learning-journal cewing$
</pre></div>
</div>
<p>Now, open a web browser and point it at your <code class="docutils literal"><span class="pre">learning-journal</span></code> repository in
GitHub.</p>
<p>On the right side of the homepage, find the <strong>Pull Requests</strong> menu item and
click it.</p>
<a class="reference internal image-reference" href="../../_images/lj_pull_request_menu.png"><img alt="../../_images/lj_pull_request_menu.png" src="../../_images/lj_pull_request_menu.png" style="width: 35%;" /></a>
<p>The page that opens should have a big green button for creating a new pull
request.  Click it.</p>
<a class="reference internal image-reference" href="../../_images/lj_new_pull_request.png"><img alt="../../_images/lj_new_pull_request.png" src="../../_images/lj_new_pull_request.png" style="width: 90%;" /></a>
<p>Next, in the page that opens, choose your <code class="docutils literal"><span class="pre">master</span></code> branch as the base and
your <code class="docutils literal"><span class="pre">step1</span></code> branch to compare (You may have to click an <strong>edit</strong> button in
the grey area to be able to change what is automatically selected).</p>
<img alt="../../_images/lj_editing_pull_request.png" src="../../_images/lj_editing_pull_request.png" />
<p>When you have the right values selected, go ahead and click the big green
button to create your pull request.</p>
<p>Copy the URL for that pull request and use it to submit this assignment in
Canvas.</p>
</div>
<div class="section" id="merge-to-master">
<h3>Merge to Master<a class="headerlink" href="#merge-to-master" title="Permalink to this headline">¶</a></h3>
<p>Heroku prefers you to deploy from your <code class="docutils literal"><span class="pre">master</span></code> branch. That makes sense.
It&#8217;s in keeping with standard gitflow to have <code class="docutils literal"><span class="pre">master</span></code> be the deployable
branch in your repository.</p>
<p>You&#8217;ve been doing your work on a branch, <code class="docutils literal"><span class="pre">step1</span></code>.  Now that you are ready to
deploy, it&#8217;s time to merge that work.</p>
<p>Make sure that you&#8217;ve committed and pushed all your work to-date before you
take this next set of actions.</p>
<p>When all is squared away, in your terminal, type the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">step1</span><span class="o">=]</span>
192:learning-journal cewing$ git checkout master
Switched to branch <span class="s1">&#39;master&#39;</span>
Your branch is up-to-date with <span class="s1">&#39;origin/master&#39;</span>.
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ git merge step1
Adding journal.py
Adding Procfile
<span class="o">[</span>master 179e695<span class="o">]</span> Merge branch <span class="s1">&#39;step1&#39;</span>
192:learning-journal cewing$ git status
On branch master
Your branch is ahead of <span class="s1">&#39;origin/master&#39;</span> by <span class="m">7</span> commits.
  <span class="o">(</span>use <span class="s2">&quot;git push&quot;</span> to publish your <span class="nb">local</span> commits<span class="o">)</span>

nothing to commit, working directory clean
<span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span>master&gt;<span class="o">]</span>
192:learning-journal cewing$ git push origin master
Counting objects: 7, <span class="k">done</span>.
Delta compression using up to <span class="m">8</span> threads.
Compressing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="m">342</span> bytes <span class="p">|</span> <span class="m">0</span> bytes/s, <span class="k">done</span>.
Total <span class="m">3</span> <span class="o">(</span>delta 2<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>
To git@github.com:cewing/learning-journal.git
   0774bf1..179e695  master -&gt; master
</pre></div>
</div>
<p>By merging locally and then pushing, you have just closed the pull request you
opened a moment ago.  That&#8217;s okay. It is still available for viewing and
comments, and that was the point of it.</p>
<p>At this point, then you have merged your <code class="docutils literal"><span class="pre">step1</span></code> work back into <code class="docutils literal"><span class="pre">master</span></code>
and are ready to deploy your code.</p>
</div>
<div class="section" id="create-a-heroku-app">
<h3>Create a Heroku App<a class="headerlink" href="#create-a-heroku-app" title="Permalink to this headline">¶</a></h3>
<p>The first step in deployment is to create a Heroku app to which you can deploy.
Use the <code class="docutils literal"><span class="pre">create</span></code> command from the Heroku toolbelt to accomplish this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ heroku create
Creating fizzy-fairy-1234... <span class="k">done</span>, stack is cedar
http://fizzy-fairy-1234.herokuapp.com/ <span class="p">|</span> git@heroku.com:fizzy-fairy-1234.git
Git remote heroku added
</pre></div>
</div>
<p>This accomplishes a few things.  First, a special <code class="docutils literal"><span class="pre">heroku</span></code> remote is added to
your git repository.  You can see this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ git remote -v
heroku  git@heroku.com:fizzy-fairy-1234.git <span class="o">(</span>fetch<span class="o">)</span>
heroku  git@heroku.com:fizzy-fairy-1234.git <span class="o">(</span>push<span class="o">)</span>
origin  git@github.com:cewing/learning-journal.git <span class="o">(</span>fetch<span class="o">)</span>
origin  git@github.com:cewing/learning-journal.git <span class="o">(</span>push<span class="o">)</span>
</pre></div>
</div>
<p>Notice that the URL for this new remote is the same as the subdomain name
Heroku assigned to your app. You <em>can</em> control what this name is, but there&#8217;s
no real need as you will be pointing your own URL at the app soon enough.  The
goofy names automatically created are just fine. for now.</p>
<p>Second, a place is created in Heroku&#8217;s infrastructure for your application to
live.  When you push to the heroku remote, your app will be uploaded, built and
deployed so that it is visible online.</p>
<p>Before we&#8217;re ready to do that, though we have to do one more thing.</p>
</div>
<div class="section" id="add-postgresql-to-heroku">
<h3>Add PostgreSQL to Heroku<a class="headerlink" href="#add-postgresql-to-heroku" title="Permalink to this headline">¶</a></h3>
<p>Heroku provides a number of different options for data stores. In order to use
any of them, you&#8217;ll need to set them up. Our app is designed to use PostgreSQL,
so we need to set up the Heroku add-on that allows us to use that database in
deployment. The Heroku toolbelt provides a command for this as well:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ heroku addons:create heroku-postgresql:dev
Creating hippy-trippy-1234... <span class="k">done</span>, <span class="o">(</span>free<span class="o">)</span>
Adding hippy-trippy-1234 to fizzy-fairy-1234... <span class="k">done</span>
Setting DATABASE_URL and restarting fizzy-fairy-1234... <span class="k">done</span>, v3
Database has been created and is available
 ! This database is empty. If upgrading, you can transfer
 ! data from another database with pgbackups:restore
Use <span class="sb">`</span>heroku addons:docs heroku-postgresql<span class="sb">`</span> to view documentation.
</pre></div>
</div>
<p>Now your app on Heroku is set up to use a PostgreSQL database. A URL has been
created for you to connect to. You can see the toolbelt setting
<code class="docutils literal"><span class="pre">DATABASE_URL</span></code> for you. Your app expects this <code class="docutils literal"><span class="pre">DATABASE_URL</span></code> to exist in
your environment. You can run <code class="docutils literal"><span class="pre">heroku</span> <span class="pre">config</span></code> to see the values that are set
in the environment for your heroku app:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
Banks:learning-journal cewing$ heroku <span class="nv">config</span>
<span class="o">===</span> fizzy-fairy-1234 Config Vars
DATABASE_URL: postgres://&lt;username&gt;:&lt;pw&gt;@&lt;domain&gt;:&lt;port&gt;/&lt;db_name&gt;
</pre></div>
</div>
<p>Super.  All is well and you are ready to deploy</p>
</div>
<div class="section" id="deploy-to-heroku">
<h3>Deploy to Heroku<a class="headerlink" href="#deploy-to-heroku" title="Permalink to this headline">¶</a></h3>
<p>To deploy, simply use <code class="docutils literal"><span class="pre">git</span></code> to push your master branch to the <code class="docutils literal"><span class="pre">heroku</span></code>
remote:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ git push heroku master
Initializing repository, <span class="k">done</span>.
Counting objects: 79, <span class="k">done</span>.
Delta compression using up to <span class="m">8</span> threads.
Compressing objects: 100% <span class="o">(</span>52/52<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>79/79<span class="o">)</span>, 11.37 KiB <span class="p">|</span> <span class="m">0</span> bytes/s, <span class="k">done</span>.
Total <span class="m">79</span> <span class="o">(</span>delta 37<span class="o">)</span>, reused <span class="m">55</span> <span class="o">(</span>delta 24<span class="o">)</span>

-----&gt; Python app detected
-----&gt; No runtime.txt provided<span class="p">;</span> assuming python-2.7.6.
-----&gt; Preparing Python runtime <span class="o">(</span>python-2.7.6<span class="o">)</span>
-----&gt; Installing Setuptools <span class="o">(</span>2.1<span class="o">)</span>
-----&gt; Installing Pip <span class="o">(</span>1.5.4<span class="o">)</span>
-----&gt; Installing dependencies using Pip <span class="o">(</span>1.5.4<span class="o">)</span>
       Downloading/unpacking <span class="nv">Flask</span><span class="o">==</span>0.10.1 <span class="o">(</span>from -r requirements.txt <span class="o">(</span>line 1<span class="o">))</span>

       ....

       Successfully installed Flask Jinja2 MarkupSafe Werkzeug gunicorn itsdangerous psycopg2
       Cleaning up...
-----&gt; Discovering process types
       Procfile declares types -&gt; web

-----&gt; Compressing... <span class="k">done</span>, 31.5MB
-----&gt; Launching... <span class="k">done</span>, v5
       http://fizzy-fairy-1234.herokuapp.com/ deployed to Heroku

To git@heroku.com:fizzy-fairy-1234.git
 * <span class="o">[</span>new branch<span class="o">]</span>      master -&gt; master
</pre></div>
</div>
<p>Load up the URL above (the one that was &#8220;deployed to Heroku&#8221;).  You should see
your &#8220;Hello world!&#8221;.</p>
<p>If you do, then hoorah.  All that remains is to initialize your database on
Heroku.</p>
<p>You can attach to a Python terminal running in your deployed environment using
the Heroku toolbelt:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
192:learning-journal cewing$ heroku run python
Running <span class="sb">`</span>python<span class="sb">`</span> attached to terminal... up, run.8229
Python 2.7.6 <span class="o">(</span>default, Jan <span class="m">16</span> 2014, 02:39:37<span class="o">)</span>
<span class="o">[</span>GCC 4.4.3<span class="o">]</span> on linux2
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for</span> more information.
&gt;&gt;&gt;
</pre></div>
</div>
<p>From there, it&#8217;s just like what you did locally a short while ago:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">journal</span> <span class="kn">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Use the standard <code class="docutils literal"><span class="pre">^D</span></code> to detatch from the terminal.</p>
<p>You may wish to verify that your initialization worked.  You can use the
<code class="docutils literal"><span class="pre">heroku</span> <span class="pre">pg</span></code> command to connect to the database directly with <code class="docutils literal"><span class="pre">psql</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>learning-journal<span class="o">]</span>
<span class="o">[</span><span class="nv">master</span><span class="o">=]</span>
heffalump:learning-journal cewing$ heroku pg:psql
---&gt; Connecting to HEROKU_POSTGRESQL_RED_URL <span class="o">(</span>DATABASE_URL<span class="o">)</span>
psql <span class="o">(</span>9.3.2, server 9.3.5<span class="o">)</span>
SSL connection <span class="o">(</span>cipher: DHE-RSA-AES256-SHA, bits: 256<span class="o">)</span>
Type <span class="s2">&quot;help&quot;</span> <span class="k">for</span> help.

evening-brushlands-7955::RED<span class="o">=</span>&gt; <span class="se">\d</span>
                  List of relations
 Schema <span class="p">|</span>      Name      <span class="p">|</span>   Type   <span class="p">|</span>     Owner
--------+----------------+----------+----------------
 public <span class="p">|</span> entries        <span class="p">|</span> table    <span class="p">|</span> kaplujiadphtmg
 public <span class="p">|</span> entries_id_seq <span class="p">|</span> sequence <span class="p">|</span> kaplujiadphtmg
<span class="o">(</span><span class="m">2</span> rows<span class="o">)</span>

evening-brushlands-7955::RED<span class="o">=</span>&gt; <span class="se">\d</span> entries
                                    Table <span class="s2">&quot;public.entries&quot;</span>
 Column  <span class="p">|</span>            Type             <span class="p">|</span>                      Modifiers
---------+-----------------------------+------------------------------------------------------
 id      <span class="p">|</span> integer                     <span class="p">|</span> not null default nextval<span class="o">(</span><span class="s1">&#39;entries_id_seq&#39;</span>::regclass<span class="o">)</span>
 title   <span class="p">|</span> character varying<span class="o">(</span>127<span class="o">)</span>      <span class="p">|</span> not null
 text    <span class="p">|</span> text                        <span class="p">|</span> not null
 created <span class="p">|</span> timestamp without <span class="nb">time</span> zone <span class="p">|</span> not null
Indexes:
    <span class="s2">&quot;entries_pkey&quot;</span> PRIMARY KEY, btree <span class="o">(</span>id<span class="o">)</span>
</pre></div>
</div>
<p>This shows that your database does in fact have the <code class="docutils literal"><span class="pre">entries</span></code> table, and the
table is correctly configured. At this point you&#8217;re safely done for the day.
Good work!</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Python Learning Journal: Step 1</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#create-your-environment">Create Your Environment</a><ul>
<li><a class="reference internal" href="#set-up-the-project-environment">Set Up the Project Environment</a></li>
<li><a class="reference internal" href="#create-a-github-project-repository">Create a GitHub Project Repository</a></li>
<li><a class="reference internal" href="#clone-your-repository">Clone Your Repository</a></li>
<li><a class="reference internal" href="#create-a-branch-for-today-s-work">Create a Branch for Today&#8217;s Work</a></li>
<li><a class="reference internal" href="#install-required-software">Install Required Software</a></li>
<li><a class="reference internal" href="#preserve-your-installed-dependencies">Preserve Your Installed Dependencies</a></li>
<li><a class="reference internal" href="#create-a-database">Create a Database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-the-data-layer">Building the Data Layer</a><ul>
<li><a class="reference internal" href="#the-app-skeleton">The App Skeleton</a></li>
<li><a class="reference internal" href="#the-entries-table">The <code class="docutils literal"><span class="pre">entries</span></code> Table</a></li>
<li><a class="reference internal" href="#initializing-the-db">Initializing the DB</a></li>
</ul>
</li>
<li><a class="reference internal" href="#app-deployment">App Deployment</a><ul>
<li><a class="reference internal" href="#add-a-procfile">Add a Procfile</a></li>
<li><a class="reference internal" href="#submit-a-pull-request">Submit a Pull Request</a></li>
<li><a class="reference internal" href="#merge-to-master">Merge to Master</a></li>
<li><a class="reference internal" href="#create-a-heroku-app">Create a Heroku App</a></li>
<li><a class="reference internal" href="#add-postgresql-to-heroku">Add PostgreSQL to Heroku</a></li>
<li><a class="reference internal" href="#deploy-to-heroku">Deploy to Heroku</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2016, Cris Ewing, Nicholas Hunt-Walker.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>