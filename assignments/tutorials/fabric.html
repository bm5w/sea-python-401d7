<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Task Automation with Fabric &mdash; Python 401 2.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python 401 2.1 documentation" href="../../index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />

<link rel="stylesheet" href="../../_static/custom.css" type="text/css" media="screen" charset="utf-8" />

<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../../index.html">
      <img class="logo" src="../../_static/cf_logo.png" alt="Logo"/>
      <p>Code Fellows</p>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="task-automation-with-fabric">
<h1>Task Automation with Fabric<a class="headerlink" href="#task-automation-with-fabric" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this tutorial, you will want to have the <a class="reference external" href="http://docs.fabfile.org/en/1.8/index.html">documentation for fabric</a> at
hand</p>
</div>
<p>We&#8217;ve looked at creating and destroying new AWS EC2 instances using the Python
wrapper for the AWS API, <code class="docutils literal"><span class="pre">boto</span></code>.</p>
<p>Once you have a server, you want to do something useful with it. Possible tasks
might include:</p>
<ul class="simple">
<li>installing system packages you require to support your application</li>
<li>generating configuration for those packages</li>
<li>installing your application software</li>
<li>...</li>
</ul>
<p>Manually performing these tasks is tedious. Once you have figured out how to
configure a system properly for your application, why would you want to do it
over and over again?</p>
<p>Instead, you should automate these tasks.</p>
<p>Automation ensures that you can accomplish a task with a single command, which
encourages actually doing that task more often.</p>
<p>One package available for Python to accomplish this sort of task automation is
<a class="reference external" href="http://docs.fabfile.org/en/latest/">fabric</a>. It provides a uniform interface for performing tasks either locally
or on one or more remote server.</p>
<p><code class="docutils literal"><span class="pre">Fabric</span></code> uses SSH to handle communications between your local machine and the
system you are working on, so any command you can run from a terminal is
available to be automated.</p>
<p>In this quick tutorial, we&#8217;ll walk through the process of automating the
provisioning of a new AWS EC2 instance and then installing some software on the
new system.</p>
<div class="section" id="setting-up">
<h2>Setting Up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h2>
<p>To begin with, let&#8217;s create an environment suitable for exploring <code class="docutils literal"><span class="pre">fabric</span></code>
and using <code class="docutils literal"><span class="pre">boto</span></code> to set up remote servers.</p>
<p>Begin by creating a new virtualenv project:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:~ cewing$ mkproject fabrictests
New python executable in fabrictests/bin/python
Installing setuptools, pip...done.
Creating /Users/cewing/projects/fabrictests
Setting project <span class="k">for</span> fabrictests to /Users/cewing/projects/fabrictests
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Once that&#8217;s handled, let&#8217;s install <em>both</em> boto <em>and</em> fabric:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ pip install boto fabric
Downloading/unpacking boto
  Downloading boto-2.25.0-py2.py3-none-any.whl <span class="o">(</span>1.1MB<span class="o">)</span>: 1.1MB downloaded
Downloading/unpacking fabric
  Downloading Fabric-1.8.2.tar.gz <span class="o">(</span>251kB<span class="o">)</span>: 251kB downloaded
...
... <span class="o">(</span>lots of c-compilation stuff<span class="o">)</span>
Successfully installed boto fabric paramiko pycrypto ecdsa
Cleaning up...
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Notice that fabric, since it operates over SSH, requires the Python ssh library
<code class="docutils literal"><span class="pre">paramiko</span></code>.</p>
<p>Because <code class="docutils literal"><span class="pre">fabric</span></code> will use SSH to connect to <strong>all</strong> hosts when using it&#8217;s
<code class="docutils literal"><span class="pre">run</span></code> command (including your local machine) you&#8217;ll need to enable SSH access
for your <a class="reference external" href="http://bluishcoder.co.nz/articles/mac-ssh.html">OS X</a> or <a class="reference external" href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring">Linux</a> machine.</p>
</div>
<div class="section" id="one-more-thing">
<h2>One More Thing<a class="headerlink" href="#one-more-thing" title="Permalink to this headline">¶</a></h2>
<p>We are going to set up an HTTP server on our ubuntu instance.  In order to
prove that we&#8217;ve done it, we need to be able to connect to that server via HTTP
(port 80).</p>
<p>Before you go any further, open your AWS web console. Navigate to the EC2
dashboard, and then select the &#8216;Security Groups&#8217; controls.</p>
<p>Find your <code class="docutils literal"><span class="pre">ssh-access</span></code> security group and add a new TCP rule. Allow HTTP
access via port 80 from any address.</p>
<p>Don&#8217;t forget to apply your rules changes after adding the new rule, or it won&#8217;t
take effect.</p>
</div>
<div class="section" id="fabric-basics">
<h2>Fabric Basics<a class="headerlink" href="#fabric-basics" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">Fabric</span></code> operates by providing a single command <code class="docutils literal"><span class="pre">fab</span></code>.</p>
<p>This command looks for a file in your present working directory called
<code class="docutils literal"><span class="pre">fabfile</span></code> or <code class="docutils literal"><span class="pre">fabfile.py</span></code>. If there is none, it will throw an error:</p>
<div class="highlight-text"><div class="highlight"><pre>[fabrictests]
heffalump:fabrictests cewing$ fab

Fatal error: Couldn&#39;t find any fabfiles!

Remember that -f can be used to specify fabfile path, and use -h for help.

Aborting.
[fabrictests]
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Let&#8217;s start by creating a new fabfile here in the <code class="docutils literal"><span class="pre">fabrictests</span></code> project
directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ touch fabfile.py
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>What goes into that file?</p>
<p>Python code.</p>
<p>Let&#8217;s start by creating a very simple test Python function we can use to show
how fabric works in general.</p>
<p>Open <code class="docutils literal"><span class="pre">fabfile.py</span></code> in your editor and add the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">run</span>

<span class="k">def</span> <span class="nf">host_type</span><span class="p">():</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;uname -s&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you&#8217;ve saved this, the name of the new Python function becomes available
as a <code class="docutils literal"><span class="pre">subcommand</span></code> for the <code class="docutils literal"><span class="pre">fab</span></code> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab -H localhost host_type
<span class="o">[</span>localhost<span class="o">]</span> Executing task <span class="s1">&#39;host_type&#39;</span>
<span class="o">[</span>localhost<span class="o">]</span> run: uname -s
<span class="o">[</span>localhost<span class="o">]</span> Login password <span class="k">for</span> <span class="s1">&#39;cewing&#39;</span>:
<span class="o">[</span>localhost<span class="o">]</span> out: Darwin
<span class="o">[</span>localhost<span class="o">]</span> out:


Done.
Disconnecting from localhost... <span class="k">done</span>.
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>If you see error output at this point, there is something wrong with how you&#8217;ve
set up ssh access to your machine.  Please ask for help from a TA or your
instructor.</p>
<p>Each function we define in a fabfile can perform a task on our behalf on the
specified host. These tasks can range from the simple to the highly complex. In
essence, you can think of <code class="docutils literal"><span class="pre">fabric</span></code> as supplying a way to encapsulate standard
shell actions so that you can repeat them more easily.</p>
<p>Notice that you&#8217;re local machine has prompted you to login with a password.
That&#8217;s a good thing. If you <a class="reference external" href="http://stackoverflow.com/questions/7260/how-do-i-setup-public-key-authentication">enable publickey login</a> then <code class="docutils literal"><span class="pre">fabric</span></code> will skip
this part for you. This also means that you won&#8217;t be sending your password
across a connection, so that&#8217;s nice.</p>
<div class="section" id="the-fabric-environment">
<span id="fab-env"></span><h3>The Fabric Environment<a class="headerlink" href="#the-fabric-environment" title="Permalink to this headline">¶</a></h3>
<p>Having to specify a host to connect to is a bit awkward, so <code class="docutils literal"><span class="pre">fabric</span></code> provides
a mechanism for setting this up automatically.</p>
<p>The <code class="docutils literal"><span class="pre">fabric.api</span></code> module provides a symbol <code class="docutils literal"><span class="pre">env</span></code> that allows you to share
state between different fabric tasks.  This state can be mutated locally, both
at module level and from within a given task.</p>
<p>You can hang pretty much any symbol onto this object, which is really just a
fancy Python dictionary.</p>
<p>However, there are a number of environmental settings that are present from the
get-go, and which <code class="docutils literal"><span class="pre">fabric</span></code> will refer to automatically.</p>
<p>One of these is <code class="docutils literal"><span class="pre">hosts</span></code>.  When we invoked the <code class="docutils literal"><span class="pre">fab</span></code> command with <code class="docutils literal"><span class="pre">-H</span>
<span class="pre">localhost</span></code> we were pre-populating this env attribute with the string
&#8216;localhost&#8217;.  We can do this manually.  Update your <code class="docutils literal"><span class="pre">fabfile.py</span></code> as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">run</span>
<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">env</span>

<span class="n">env</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">host_type</span><span class="p">():</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;uname -s&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Save those changes and you should now be able to run the <code class="docutils literal"><span class="pre">host_type</span></code>
subcommand without providing the host explicitly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab host_type
<span class="o">[</span>localhost<span class="o">]</span> Executing task <span class="s1">&#39;host_type&#39;</span>
<span class="o">[</span>localhost<span class="o">]</span> run: uname -s
<span class="o">[</span>localhost<span class="o">]</span> Login password <span class="k">for</span> <span class="s1">&#39;cewing&#39;</span>:
<span class="o">[</span>localhost<span class="o">]</span> out: Darwin
<span class="o">[</span>localhost<span class="o">]</span> out:


Done.
Disconnecting from localhost... <span class="k">done</span>.
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
</div>
</div>
<div class="section" id="fabric-with-boto">
<h2>Fabric with Boto<a class="headerlink" href="#fabric-with-boto" title="Permalink to this headline">¶</a></h2>
<p>Our interactions with <code class="docutils literal"><span class="pre">boto</span></code> are all oriented around creating and destroying
servers.</p>
<p>In fabric, our orientation will be toward manipulating <em>a server</em> once it
exists.</p>
<p>Before we do that, though we need to get a server running.</p>
<p>Any attempt we make at dealing with AWS EC2 through boto will require that we
have a connection. Our first step must be to make a connection to the region we
want to use.  Let&#8217;s add a function to do this to our <code class="docutils literal"><span class="pre">fabfile.py</span></code>. We&#8217;ll use
the <a class="reference internal" href="#fab-env"><span>fabric env</span></a> as a place to hold the established
connection so we can easily use it from other functions.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock1'))">Peek At A Solution</a><br /><div id="hiddencodeblock1" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># add an import</span>
<span class="kn">import</span> <span class="nn">boto.ec2</span>

<span class="c1"># add an environmental setting</span>
<span class="n">env</span><span class="o">.</span><span class="n">aws_region</span> <span class="o">=</span> <span class="s1">&#39;us-west-2&#39;</span>

<span class="c1"># add a function</span>
<span class="k">def</span> <span class="nf">get_ec2_connection</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;ec2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">ec2</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">aws_region</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">ec2</span> <span class="o">=</span> <span class="n">conn</span>
            <span class="k">print</span> <span class="s2">&quot;Connected to EC2 region </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">aws_region</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unable to connect to EC2 region </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">aws_region</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">ec2</span>
</pre></div>
</div>
</div><p>We can call fabric functions from other fabric functions, so this will be of
use to us as we try to provision, manage and deprovision our servers.</p>
<div class="section" id="provisioning-an-instance">
<h3>Provisioning an Instance<a class="headerlink" href="#provisioning-an-instance" title="Permalink to this headline">¶</a></h3>
<p>In the <code class="docutils literal"><span class="pre">boto</span></code> walkthrough, we saw how to provision a new instance and set it
running.  Let&#8217;s convert that code to a fabric task.</p>
<p>We&#8217;ll need to start by getting a connection, then use that connection to create
a new instance.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock2'))">Peek At A Solution</a><br /><div id="hiddencodeblock2" style="display: none"><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1"># add an import at the top</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># add this function</span>
<span class="k">def</span> <span class="nf">provision_instance</span><span class="p">(</span><span class="n">wait_for_running</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">wait_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
    <span class="n">timeout_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">get_ec2_connection</span><span class="p">()</span>
    <span class="n">instance_type</span> <span class="o">=</span> <span class="s1">&#39;t2.micro&#39;</span>
    <span class="n">key_name</span> <span class="o">=</span> <span class="s1">&#39;pk-aws&#39;</span>
    <span class="n">security_group</span> <span class="o">=</span> <span class="s1">&#39;ssh-access&#39;</span>
    <span class="n">image_id</span> <span class="o">=</span> <span class="s1">&#39;ami-d0d8b8e0&#39;</span>

    <span class="n">reservations</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_instances</span><span class="p">(</span>
        <span class="n">image_id</span><span class="p">,</span>
        <span class="n">key_name</span><span class="o">=</span><span class="n">key_name</span><span class="p">,</span>
        <span class="n">instance_type</span><span class="o">=</span><span class="n">instance_type</span><span class="p">,</span>
        <span class="n">security_groups</span><span class="o">=</span><span class="p">[</span><span class="n">security_group</span><span class="p">,</span> <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">new_instances</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reservations</span><span class="o">.</span><span class="n">instances</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">u&#39;pending&#39;</span><span class="p">]</span>
    <span class="n">running_instance</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">wait_for_running</span><span class="p">:</span>
        <span class="n">waited</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">new_instances</span> <span class="ow">and</span> <span class="p">(</span><span class="n">waited</span> <span class="o">&lt;</span> <span class="n">timeout_val</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_val</span><span class="p">)</span>
            <span class="n">waited</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wait_val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">new_instances</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">state</span>
                <span class="k">print</span> <span class="s2">&quot;Instance </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                    <span class="n">running_instance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">new_instances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">new_instances</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="p">)</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div><p>There&#8217;s something new in this function.  It accepts arguments. We can pass
arguments like this from the command-line when we run the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab provision_instance
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab provision_instance:wait_for_running<span class="o">=</span>1
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab provision_instance:wait_for_running<span class="o">=</span>1,interval<span class="o">=</span>5
</pre></div>
</div>
<p>The important part to know about this is that arguments passed in from the
command line appear in your function as strings.  You are responsible for
converting them if needed.</p>
<p>Let&#8217;s provision a new server with this function:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab provision_instance:wait_for_running<span class="o">=</span>1
<span class="o">[</span>localhost<span class="o">]</span> Executing task <span class="s1">&#39;provision_instance&#39;</span>
Connected to EC2 region us-west-2
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is pending
Instance i-8c424a85 is running

Done.
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Once the function completes, you should be able to load your EC2 dashboard and
see the new instance you just created running happily.</p>
</div>
</div>
<div class="section" id="running-shell-commands-on-a-server">
<h2>Running Shell Commands on a Server<a class="headerlink" href="#running-shell-commands-on-a-server" title="Permalink to this headline">¶</a></h2>
<p>Now that we have an instance running, we want to run commands on it to
configure it.</p>
<p>As you&#8217;ve seen, Fabric provides the <code class="docutils literal"><span class="pre">run</span></code> command to allow this.</p>
<p>But there&#8217;s an issue.  When you execute a function using fabric, it is actually
run repeatedly, once for each <code class="docutils literal"><span class="pre">host</span></code> you list in the <code class="docutils literal"><span class="pre">env.hosts</span></code>
environment setting.</p>
<p>At the moment, our script lists &#8216;localhost&#8217;, but we don&#8217;t actually want to run
this command on &#8216;localhost&#8217;, so we need to get around this.</p>
<p>We could add a new host into the list, but that would require our knowing the
name of the host ahead of time. Moreover, it would still mean that the commands
were run <em>both</em> on localhost and this new remote host.  That&#8217;s no good.</p>
<p>Fabric provides <a class="reference external" href="http://docs.fabfile.org/en/1.8/api/core/tasks.html#fabric.tasks.execute">the execute command</a> specifically for this purpose.  We can
pass it the list of hosts on which we want to run a particular command, and it
will do so for us. This means that we can dynamically set the name of the
instance we want, and <code class="docutils literal"><span class="pre">fabric</span></code> will execute our chosen command on that server
only!</p>
<p>In order to play with that, though, we need to interactively select the
instance we want to use (after all, we might have more than one, right?).</p>
<p>We&#8217;ll begin by building a function that allows us to list instances, optionally
filtering for a particular state.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock3'))">Peek At A Solution</a><br /><div id="hiddencodeblock3" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">list_aws_instances</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">get_ec2_connection</span><span class="p">()</span>

    <span class="n">reservations</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_all_reservations</span><span class="p">()</span>
    <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">reservations</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">instance</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance_type</span><span class="p">,</span>
                    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">image_id</span><span class="p">,</span>
                    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                    <span class="s1">&#39;instance&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">instances</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pprint</span>
        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
</pre></div>
</div>
</div><p>If we run this command from the command line, we should see our running
instance:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab list_aws_instances:verbose<span class="o">=</span>1,state<span class="o">=</span>running
<span class="o">[</span>localhost<span class="o">]</span> Executing task <span class="s1">&#39;list_aws_instances&#39;</span>
Connected to EC2 region us-west-2
<span class="o">[{</span><span class="s1">&#39;id&#39;</span>: u<span class="s1">&#39;i-ab5159a2&#39;</span>,
  <span class="s1">&#39;image&#39;</span>: u<span class="s1">&#39;ami-d0d8b8e0&#39;</span>,
  <span class="s1">&#39;instance&#39;</span>: Instance:i-ab5159a2,
  <span class="s1">&#39;state&#39;</span>: u<span class="s1">&#39;running&#39;</span>,
  <span class="s1">&#39;type&#39;</span>: u<span class="s1">&#39;t2.micro&#39;</span><span class="o">}]</span>

Done.
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Nice.</p>
<p>Now we must create a function that will take the output of that function and
give us an interactive choice of running instances on which to take a given
action. Fabric provides <code class="docutils literal"><span class="pre">prompt</span></code>, <a class="reference external" href="http://docs.fabfile.org/en/1.8/api/core/operations.html#fabric.operations.prompt">a function</a> which will ask for input from
the user at run time.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock4'))">Peek At A Solution</a><br /><div id="hiddencodeblock4" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># add an import</span>
<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">prompt</span>

<span class="k">def</span> <span class="nf">select_instance</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;running&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;active_instance&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="n">list_aws_instances</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>

    <span class="n">prompt_text</span> <span class="o">=</span> <span class="s2">&quot;Please select from the following instances:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">instance_template</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%(ct)d</span><span class="s2">: </span><span class="si">%(state)s</span><span class="s2"> instance </span><span class="si">%(id)s</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">instances</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ct&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="p">}</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">prompt_text</span> <span class="o">+=</span> <span class="n">instance_template</span> <span class="o">%</span> <span class="n">args</span>
    <span class="n">prompt_text</span> <span class="o">+=</span> <span class="s2">&quot;Choose an instance: &quot;</span>

    <span class="k">def</span> <span class="nf">validation</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> is not a valid instance&quot;</span> <span class="o">%</span> <span class="n">choice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">choice</span>

    <span class="n">choice</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validation</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">active_instance</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div><p>Here, we build a list of the available instances that are &#8216;running&#8217;, and then
ask the user to choose among them. After a valid choice is made, we can then
hang that instance on our <code class="docutils literal"><span class="pre">env</span></code> so that we can access it from other
functions. We can also short-circuit this behavior by checking first to see if
we&#8217;ve already selected an instance.</p>
<p>Now, let&#8217;s set up a function that will run a given command (passed by name as
an argument) on the server we select.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock5'))">Peek At A Solution</a><br /><div id="hiddencodeblock5" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># add an import</span>
<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">execute</span>

<span class="k">def</span> <span class="nf">run_command_on_selected_server</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="n">select_instance</span><span class="p">()</span>
    <span class="n">selected_hosts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;ubuntu@&#39;</span> <span class="o">+</span> <span class="n">env</span><span class="o">.</span><span class="n">active_instance</span><span class="o">.</span><span class="n">public_dns_name</span>
    <span class="p">]</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">hosts</span><span class="o">=</span><span class="n">selected_hosts</span><span class="p">)</span>
</pre></div>
</div>
</div><p>This function begins by asking the user to select an instance.  Then it sets up
a list of hosts that includes that server (with the username &#8216;ubuntu&#8217;
hard-coded). Finally, it attempts to execute the command we provide as an
argument on the list of hosts we just built.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember, you cannot use password authentication to log into AWS servers.
If you find that you are prompted to enter a password in order to run this
command on your remote server, it means you have some work to do.</p>
</div>
<p>In order to run a command on this server, you need to ensure that the keypair
you set up for your AWS instances is available to the ssh agent. You can do
that at the system level on your local machine:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ ssh-add ~/.ssh/pk-aws.pem
Identity added: /Users/cewing/.ssh/pk-aws.pem <span class="o">(</span>/Users/cewing/.ssh/pk-aws.pem<span class="o">)</span>
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>Now your local ssh agent knows that this is a file you might use to connect.
When the AWS server asks to use public-key authentication, the agent will then
try this key along with any others the agent knows about. If no known key
works, ssh will bomb out.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Sometimes your ssh agent will <em>forget</em> the keys you&#8217;ve added.  If you wish,
you can also short-circuit the selection of a key by specifying which key
to use in your fabric <code class="docutils literal"><span class="pre">env</span></code> (in <code class="docutils literal"><span class="pre">fabfile.py</span></code>):</p>
<blockquote class="last">
<div>env.key_filename = &#8216;/path/to/keyfile.pem&#8217;</div></blockquote>
</div>
<p><code class="docutils literal"><span class="pre">Execute</span></code> <a class="reference external" href="http://docs.fabfile.org/en/1.8/api/core/tasks.html#fabric.tasks.execute">will take</a> the name of a fabric command to run. We need a command
that it will run that will install nginx for us and then start it.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock6'))">Peek At A Solution</a><br /><div id="hiddencodeblock6" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="c1"># add an import</span>
<span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">sudo</span>

<span class="k">def</span> <span class="nf">_install_nginx</span><span class="p">():</span>
    <span class="n">sudo</span><span class="p">(</span><span class="s1">&#39;apt-get install nginx&#39;</span><span class="p">)</span>
    <span class="n">sudo</span><span class="p">(</span><span class="s1">&#39;/etc/init.d/nginx start&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div><p>Finally, we need to wrap this function in a function we might call from the
command line that will run it on the server we select.</p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock7'))">Peek At A Solution</a><br /><div id="hiddencodeblock7" style="display: none"><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">install_nginx</span><span class="p">():</span>
    <span class="n">run_command_on_selected_server</span><span class="p">(</span><span class="n">_install_nginx</span><span class="p">)</span>
</pre></div>
</div>
</div><p>Now, if we run this fabric command from our command line, we can get nginx
installed on our AWS instance:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$ fab install_nginx
<span class="o">[</span>localhost<span class="o">]</span> Executing task <span class="s1">&#39;install_nginx&#39;</span>
Connected to EC2 region us-west-2
Please <span class="k">select</span> from the following instances:
 1: running instance i-ab5159a2
Choose an instance: 1
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> Executing task <span class="s1">&#39;_install_nginx&#39;</span>
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> sudo: apt-get install nginx
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out:
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Reading package lists... 0%
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out:
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Reading package lists... 0%
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out:
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Reading package lists... 24%
...
...
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Setting up nginx-full <span class="o">(</span>1.1.19-1ubuntu0.5<span class="o">)</span> ...
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Setting up nginx <span class="o">(</span>1.1.19-1ubuntu0.5<span class="o">)</span> ...
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: Processing triggers <span class="k">for</span> libc-bin ...
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out: ldconfig deferred processing now taking place
<span class="o">[</span>ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com<span class="o">]</span> out:


Done.
Disconnecting from ubuntu@ec2-54-185-44-188.us-west-2.compute.amazonaws.com... <span class="k">done</span>.
<span class="o">[</span>fabrictests<span class="o">]</span>
heffalump:fabrictests cewing$
</pre></div>
</div>
<p>At this point, you should be able to open a web browser and point it at your
EC2 instance and see the default nginx web page.  Remember, the public_dns_name
of your instance is the way to get at it, so use that in your browser:</p>
<div class="highlight-python"><div class="highlight"><pre>http://ec2-54-185-44-188.us-west-2.compute.amazonaws.com
</pre></div>
</div>
</div>
<div class="section" id="stopping-and-terminating-an-instance">
<h2>Stopping and Terminating an Instance<a class="headerlink" href="#stopping-and-terminating-an-instance" title="Permalink to this headline">¶</a></h2>
<p>Challenge yourself to add two more functions:</p>
<ol class="arabic simple">
<li>Select a <em>running</em> instance to stop, and then stop it with boto</li>
<li>Select a <em>stopped</em> instance to terminate, and then terminate it with boto</li>
</ol>
<p>Good Luck!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Task Automation with Fabric</a><ul>
<li><a class="reference internal" href="#setting-up">Setting Up</a></li>
<li><a class="reference internal" href="#one-more-thing">One More Thing</a></li>
<li><a class="reference internal" href="#fabric-basics">Fabric Basics</a><ul>
<li><a class="reference internal" href="#the-fabric-environment">The Fabric Environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fabric-with-boto">Fabric with Boto</a><ul>
<li><a class="reference internal" href="#provisioning-an-instance">Provisioning an Instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-shell-commands-on-a-server">Running Shell Commands on a Server</a></li>
<li><a class="reference internal" href="#stopping-and-terminating-an-instance">Stopping and Terminating an Instance</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2016, Cris Ewing, Nicholas Hunt-Walker.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>