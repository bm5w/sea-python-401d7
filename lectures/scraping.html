<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extracting Data from the Web &mdash; Python 401 2.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python 401 2.1 documentation" href="../index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />

<link rel="stylesheet" href="../_static/custom.css" type="text/css" media="screen" charset="utf-8" />

<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../index.html">
      <img class="logo" src="../_static/cf_logo.png" alt="Logo"/>
      <p>Code Fellows</p>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="extracting-data-from-the-web">
<h1>Extracting Data from the Web<a class="headerlink" href="#extracting-data-from-the-web" title="Permalink to this headline">¶</a></h1>
<div class="left container">
<p>The internet makes a vast quantity of data available.</p>
<div class="build container">
<p>But not always in the form or combination you want.</p>
<p>It can be nice to combine data from different sources to create
<em>meaning</em>.</p>
</div>
</div>
<div class="section" id="part-1-web-scraping">
<h2>Part 1: Web Scraping<a class="headerlink" href="#part-1-web-scraping" title="Permalink to this headline">¶</a></h2>
<div class="left container">
<p>Data online comes in many different formats:</p>
<div class="build container">
<ul class="build simple">
<li>Simple websites with static (or perhaps dynamic) data in HTML</li>
<li>Web services providing structured data</li>
<li>Web services providing tranformative service (geocoding)</li>
<li>Web services providing presentation (mapping)</li>
</ul>
<p>Let&#8217;s concentrate for now on that first class of data, HTML.</p>
</div>
</div>
<div class="section" id="html-data">
<h3>HTML Data<a class="headerlink" href="#html-data" title="Permalink to this headline">¶</a></h3>
<p>Ideally HTML would be well-formed and strictly correct in it&#8217;s structure:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>A nice clean paragraph<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>And another nice clean paragraph<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>But in fact, it usually ends up looking more like this:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;input1&quot;</span><span class="p">&gt;</span>Row 1 cell 1
   <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Row 2 cell 1
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Row 2 cell 2<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>This<span class="p">&lt;/</span><span class="nt">br</span><span class="p">&gt;</span> sure is a long cell
 <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This is the result of one of the fundamental laws of the internet:</p>
<p><strong>&#8220;Be strict in what you send and tolerant in what you receive&#8221;</strong></p>
<div class="centered container">
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/scream.jpg"><img alt="../_images/scream.jpg" src="../_images/scream.jpg" style="width: 35%;" /></a>
<p class="caption"><span class="caption-text">Photo by Matthew via Flickr (<a class="reference external" href="http://www.flickr.com/photos/purplemattfish/3918004964/">http://www.flickr.com/photos/purplemattfish/3918004964/</a>) - CC-BY-NC-ND</span></p>
</div>
</div>
</div>
<div class="section" id="cleaning-up-the-mess">
<h3>Cleaning Up the Mess<a class="headerlink" href="#cleaning-up-the-mess" title="Permalink to this headline">¶</a></h3>
<p>My favorite library for dealing with the mess that HTML can become is
<a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>. So let&#8217;s go ahead and create a virtualenv for playing
with it a bit:</p>
<p>Then, install the correct version of BeautifulSoup (you want 4, not 3):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$ pip install beautifulsoup4
Downloading/unpacking beautifulsoup4
  Downloading beautifulsoup4-4.3.2.tar.gz <span class="o">(</span>143kB<span class="o">)</span>: 143kB downloaded
  Running setup.py <span class="o">(</span>path:/Users/cewing/virtualenvs/souptests/build/beautifulsoup4/setup.py<span class="o">)</span> egg_info <span class="k">for</span> package beautifulsoup4

Installing collected packages: beautifulsoup4
  Running setup.py install <span class="k">for</span> beautifulsoup4

Successfully installed beautifulsoup4
Cleaning up...
<span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$
</pre></div>
</div>
<p>BeautifulSoup can use the Python HTMLParser.</p>
<div class="build container">
<p><strong>PRO</strong>: Batteries Included.  It&#8217;s already there</p>
<p><strong>CON</strong>: It&#8217;s not great, especially before Python 2.7.3</p>
<p>BeautifulSoup also supports using other parsers.</p>
<p>There are two good choices: <a class="reference external" href="http://lxml.de">lxml</a>  and <a class="reference external" href="http://html5lib.readthedocs.org.">html5lib</a>.</p>
</div>
<p><code class="docutils literal"><span class="pre">lxml</span></code> is better, but it can be much harder to install.  For our exercise,
Let&#8217;s use <code class="docutils literal"><span class="pre">html5lib</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$ pip install html5lib
Downloading/unpacking html5lib
  Downloading html5lib-0.999.tar.gz <span class="o">(</span>885kB<span class="o">)</span>: 885kB downloaded
  Running setup.py <span class="o">(</span>path:/Users/cewing/virtualenvs/souptests/build/html5lib/setup.py<span class="o">)</span> egg_info <span class="k">for</span> package html5lib

Downloading/unpacking six <span class="o">(</span>from html5lib<span class="o">)</span>
  Downloading six-1.5.2-py2.py3-none-any.whl
Installing collected packages: html5lib, six
  Running setup.py install <span class="k">for</span> html5lib

Successfully installed html5lib six
Cleaning up...
<span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$
</pre></div>
</div>
<p>Once installed, BeautifulSoup will choose <code class="docutils literal"><span class="pre">html5lib</span></code> automatically.</p>
<div class="build container">
<p>Actually, BeautifulSoup will choose the &#8220;best&#8221; available.</p>
<p>You can specify the parser if you need to control it <em>and</em> you have more
than one parser available.</p>
</div>
</div>
<div class="section" id="getting-webpages">
<h3>Getting Webpages<a class="headerlink" href="#getting-webpages" title="Permalink to this headline">¶</a></h3>
<p>As with IMAP, FTP and other web protocols, Python provides tools for using HTTP
as a client. They are spread across the <code class="docutils literal"><span class="pre">urllib</span></code> and <code class="docutils literal"><span class="pre">urllib2</span></code> packages.</p>
<div class="build container">
<p>These packages have pretty unintuitive APIs.</p>
<p>The <code class="docutils literal"><span class="pre">requests</span></code> library is becoming the de-facto standard for this type of
work.  Let&#8217;s install it too.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$ pip install requests
Downloading/unpacking requests
  Downloading requests-2.2.1-py2.py3-none-any.whl <span class="o">(</span>625kB<span class="o">)</span>: 625kB downloaded
Installing collected packages: requests
Successfully installed requests
Cleaning up...
<span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$
</pre></div>
</div>
</div>
<p>In <code class="docutils literal"><span class="pre">requests</span></code>, each HTTP method is provided by a module-level function:</p>
<ul class="build simple">
<li><code class="docutils literal"><span class="pre">GET</span></code> == <code class="docutils literal"><span class="pre">requests.get(url,</span> <span class="pre">**kwargs)</span></code></li>
<li><code class="docutils literal"><span class="pre">POST</span></code> == <code class="docutils literal"><span class="pre">requests.post(url,</span> <span class="pre">**kwargs)</span></code></li>
<li>...</li>
</ul>
<div class="build container">
<p>Those unspecified <code class="docutils literal"><span class="pre">kwargs</span></code> represent other parts of an HTTP request:</p>
<ul class="build simple">
<li><code class="docutils literal"><span class="pre">params</span></code>: a dict of url query parameters (?foo=bar&amp;baz=bim)</li>
<li><code class="docutils literal"><span class="pre">headers</span></code>: a dict of headers to send with the request</li>
<li><code class="docutils literal"><span class="pre">data</span></code>: the body of the request, if any (form data for POST goes here)</li>
<li>...</li>
</ul>
</div>
<p>The return value from one of these functions is a <code class="docutils literal"><span class="pre">response</span></code> which provides:</p>
<ul class="build simple">
<li><code class="docutils literal"><span class="pre">response.status_code</span></code>: see the HTTP Status Code returned</li>
<li><code class="docutils literal"><span class="pre">response.ok</span></code>: True if <code class="docutils literal"><span class="pre">response.status_code</span></code> is not an error</li>
<li><code class="docutils literal"><span class="pre">response.raise_for_status()</span></code>: call to raise a python error if it is</li>
<li><code class="docutils literal"><span class="pre">response.headers</span></code>: The headers sent from the server</li>
<li><code class="docutils literal"><span class="pre">response.text</span></code>: Body of the response, decoded to unicode</li>
<li><code class="docutils literal"><span class="pre">response.encoding</span></code>: The encoding used to decode</li>
<li><code class="docutils literal"><span class="pre">response.content</span></code>: The original encoded response body as bytes</li>
</ul>
<div class="build container">
<p>You can <a class="reference external" href="http://requests.readthedocs.org">read more about this library</a> on your own.</p>
<p>I urge you to do so.</p>
</div>
</div>
</div>
<div class="section" id="an-example-scraping-blog-posts">
<h2>An Example: Scraping Blog Posts<a class="headerlink" href="#an-example-scraping-blog-posts" title="Permalink to this headline">¶</a></h2>
<div class="left container">
<p>Let&#8217;s use the tools we&#8217;ve set up here to play with scraping a simple
structure, a list of blog posts.</p>
<p>Begin by firing up a Python interpreter:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing$ python
Python 2.7.5 <span class="o">(</span>default, Aug <span class="m">25</span> 2013, 00:04:04<span class="o">)</span>
<span class="o">[</span>GCC 4.2.1 Compatible Apple LLVM 5.0 <span class="o">(</span>clang-500.0.68<span class="o">)]</span> on darwin
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for</span> more information.
&gt;&gt;&gt;
</pre></div>
</div>
</div>
<div class="section" id="fetching-a-page">
<h3>Fetching a Page<a class="headerlink" href="#fetching-a-page" title="Permalink to this headline">¶</a></h3>
<p>The first step is to fetch the page we&#8217;ll be scraping.</p>
<p>I&#8217;ve created a shortened url that points to a feed aggregator for open
source blog posts.  Unfortunately, <code class="docutils literal"><span class="pre">tinyurl</span></code> won&#8217;t issue a proper
redirect response for requests that come from the <code class="docutils literal"><span class="pre">requests</span></code> library, so
we&#8217;ll have to pretend we are a real web browser.</p>
<p>Open the developer tools for your browser and make sure you are viewing the
<em>Network</em> tab so you can see network traffic your browser sends and
receives. Load the url <a class="reference external" href="http:/tinyurl.com/sample-oss-posts">http:/tinyurl.com/sample-oss-posts</a> in a new tab.
Back in the network tab, click on the requests that went to tinyurl.  Find
the headers for the request and copy the <code class="docutils literal"><span class="pre">User-Agent</span></code> header value. Then
begin to follow along in your Python interpreter:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://tinyurl.com/sample-oss-posts&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ua</span> <span class="o">=</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.111 Safari/537.36&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">ua</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">601747</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span><span class="o">.</span><span class="n">encoding</span>
<span class="go">&#39;utf-8&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;type &#39;unicode&#39;&gt;</span>
</pre></div>
</div>
<p>Let&#8217;s prevent ourselves from having to repeat that step by writing our fetched
webpage out to the filesystem:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bytes</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="go">602455</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;blog_list.html&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="go">[&#39;blog_list.html&#39;, ...]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>You should now be able to open the new file in your web browser.  Do so.</p>
<div class="build container">
<p>The first step is to identify the smallest container element comment to all
the things you want to extract.  We want to get all blog posts, so let&#8217;s
find the container that wraps each one.</p>
<p><strong>What&#8217;s the best tool for getting this information from a web page?</strong></p>
</div>
</div>
<div class="section" id="parsing-html">
<h3>Parsing HTML<a class="headerlink" href="#parsing-html" title="Permalink to this headline">¶</a></h3>
<p>When you look at the HTML from this webpage in your browser&#8217;s devtools, it
displays as a formatted structure of HTML tags.  We can interact with those
tags in devtools because they are actually just representations of a DOM node.
(DOM stands for <a class="reference external" href="http://en.wikipedia.org/wiki/Document_Object_Model">Document Object Model</a>)</p>
<p>In order to work with the page in the same fashion in Python, we need to
<strong>parse</strong> it into the same kind of structure.  That&#8217;s what <code class="docutils literal"><span class="pre">BeautifulSoup</span></code>
does for us.</p>
<div class="build highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
<span class="go">2</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>So parsing the document took the length from 601747 characters to 2 <em>??</em>. What
are those two things?</p>
<div class="build highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">]</span>
<span class="go">[&lt;class &#39;bs4.element.Doctype&#39;&gt;, &lt;class &#39;bs4.element.Tag&#39;&gt;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="build container">
<p>Once an html page has been parsed by <code class="docutils literal"><span class="pre">BeautifulSoup</span></code>, everything becomes a
<code class="docutils literal"><span class="pre">node</span></code>.  The parsed document itself is a <code class="docutils literal"><span class="pre">node</span></code> and <code class="docutils literal"><span class="pre">nodes</span></code> are iterable.</p>
<p>When you iterate over a node, you get the nodes that it contains in the DOM
tree.</p>
</div>
<p>These nodes can be roughly classed into two types, <code class="docutils literal"><span class="pre">NavigableString</span></code> and
<code class="docutils literal"><span class="pre">Tag</span></code></p>
<div class="build container">
<p>The main difference is that <code class="docutils literal"><span class="pre">Tag</span></code> nodes can contain text or other nodes,
where <code class="docutils literal"><span class="pre">NavigableStrings</span></code> contain <strong>only</strong> text.</p>
<p>You can interact with these node types in a number of ways.</p>
<p>The most common are  <em>Searching</em> and <em>Traversing</em></p>
<p>Let&#8217;s start with the simpler of the two, <em>searching</em>.</p>
</div>
</div>
<div class="section" id="searching-html">
<h3>Searching HTML<a class="headerlink" href="#searching-html" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal"><span class="pre">Tag</span></code> in <code class="docutils literal"><span class="pre">BeautifulSoup</span></code> has a couple of methods that support searching:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">tag.find()</span></code>:</dt>
<dd>will find the first instance of a node that matches the search specification</dd>
<dt><code class="docutils literal"><span class="pre">tag.find_all()</span></code>:</dt>
<dd>will find <strong>all</strong> instances that match the search specification.</dd>
</dl>
<p>So, How do we build a specification for searching? The call signature for
<code class="docutils literal"><span class="pre">find_all</span></code> helps a bit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="build simple">
<li><code class="docutils literal"><span class="pre">name</span></code> is the name of an html tag type (&#8216;a&#8217;, &#8216;p&#8217;, &#8216;div&#8217;, etc.)</li>
<li><code class="docutils literal"><span class="pre">attrs</span></code> is a dictionary of key-value pairs where the key is an html
attribute name and the value is the value you want to match.</li>
<li><code class="docutils literal"><span class="pre">recursive</span></code> controls whether to find <em>descendents</em> (the default) or just
<em>children</em> (recursive=False)</li>
<li><code class="docutils literal"><span class="pre">text</span></code> allows you to find <code class="docutils literal"><span class="pre">NavigableString</span></code> nodes instead of <code class="docutils literal"><span class="pre">Tag</span></code> nodes.</li>
<li><code class="docutils literal"><span class="pre">limit</span></code> controls how many to find, maximum.</li>
</ul>
<div class="build container">
<p>The last element <strong>kwargs</strong> allows you to pass arbitrary keyword arguments.</p>
<p>If the argument you pass is not recognized as one of the other arguments,
it will be treated as the name of an <em>HTML attribute</em> to filter on.</p>
<p>Passing <code class="docutils literal"><span class="pre">id=&quot;my-div&quot;</span></code> would result in a search for any item with the id
&#8220;my-div&#8221;:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;my-div&quot;</span><span class="p">&gt;</span>This is found<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;other-div&quot;</span><span class="p">&gt;</span>This would not be<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">because <code class="docutils literal"><span class="pre">class</span></code> is a keyword in python, you can&#8217;t use it as a keyword
argument.  Instead you should use <code class="docutils literal"><span class="pre">class_</span></code> (<code class="docutils literal"><span class="pre">class_=&quot;button&quot;</span></code>)</p>
</div>
<p>Looking at the blog listing, we can see that the container that is wrapped
around each post shares a common <em>CSS class</em>: <code class="docutils literal"><span class="pre">feedEntry</span></code>. Let&#8217;s grab all of
them:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">entries</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;feedEntry&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
<span class="go">70</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Okay. That works.</p>
<p>Let&#8217;s see if we can extract a list of the titles of each post.</p>
<p>For this, we want to make sure we find the <strong>first</strong> anchor tag in each entry,
and then extract the text it contains:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="go">u&#39;\n            Dimitri Fontaine: PostgreSQL, Aggregates and Histograms\n        &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span>
<span class="go">u&#39;Dimitri Fontaine: PostgreSQL, Aggregates and Histograms&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
<span class="go">70</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>We can also find the set of possible sources for our blog posts.  The
byline is contained in a <code class="docutils literal"><span class="pre">&lt;p&gt;</span></code> tag with the CSS class <code class="docutils literal"><span class="pre">discreet</span></code>.
Let&#8217;s gather up all of those and see what we have:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">byline</span> <span class="o">=</span> <span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;discreet&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">)]</span>
<span class="go">[&lt;class &#39;bs4.element.NavigableString&#39;&gt;, &lt;class &#39;bs4.element.Tag&#39;&gt;,</span>
<span class="go"> &lt;class &#39;bs4.element.NavigableString&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">classifier</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">classifier</span>
<span class="go">u&#39;From Planet PostgreSQL.\n            \n            \n                Published on&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_bylines</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;discreet&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">all_bylines</span><span class="p">)</span>
<span class="go">70</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_classifiers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">children</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">all_bylines</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">all_classifiers</span><span class="p">)</span>
<span class="go">70</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_classifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">u&#39;From Planet PostgreSQL.\n            \n            \n                Published on&#39;</span>
</pre></div>
</div>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">unique_classifiers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_classifiers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">unique_classifiers</span><span class="p">)</span>
<span class="go">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unique_classifiers</span><span class="p">)</span>
<span class="go">set([u&#39;u&#39;By Will McGugan from Django community aggregator:\n ...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If we look these over, we find that we have some from <code class="docutils literal"><span class="pre">Planet</span> <span class="pre">Django</span></code>, some
from <code class="docutils literal"><span class="pre">Planet</span> <span class="pre">PostgreSQL</span></code> and maybe some others as well (I get one from
<code class="docutils literal"><span class="pre">plope</span></code> too).</p>
<p>Let&#8217;s take one more step, and divide our post titles into categories based on
whether they are Django, PostgreSQL or other.</p>
<p>Start by defining a function to get the <em>classifier</em> for an entry:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_classifier</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">byline</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;discreet&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;django&#39;</span><span class="p">,</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">]:</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">byline</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">classifier</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;other&#39;</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Then use that function to find the unique set of classifiers</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_classifier</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classifiers</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">classifiers</span><span class="p">)</span>
<span class="go">set([&#39;other&#39;, &#39;postgresql&#39;, &#39;django&#39;])</span>
</pre></div>
</div>
<p>We can also extract titles for each post with a function:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_title</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_title</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
<span class="go">70</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">u&#39;A method for rendering templates with Python&#39;</span>
</pre></div>
</div>
<p>Put it all together to build a dictionary of categorized post titles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">paired</span> <span class="o">=</span> <span class="p">[(</span><span class="n">get_classifier</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">get_title</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paired</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(&#39;django&#39;, u&#39;A method for rendering templates with Python&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">paired</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">list</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="p">[])</span>
<span class="gp">... </span>    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;django&#39;</span><span class="p">]</span>
<span class="go">[u&#39;A method for rendering templates with Python&#39;,</span>
<span class="go"> u&quot;Don&#39;t import (too much) in your django settings&quot;,</span>
<span class="go"> ...]</span>
</pre></div>
</div>
<p>Neat!</p>
</div>
</div>
<div class="section" id="going-farther">
<h2>Going Farther<a class="headerlink" href="#going-farther" title="Permalink to this headline">¶</a></h2>
<p class="left">Okay, so that&#8217;s the basics. For your assignment you&#8217;ll take this a step farther
and
<a class="reference internal" href="../assignments/tutorials/scraper.html#scraper-assignment"><span>build a list of restaurant health inspection data</span></a>
using the King County government website.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extracting Data from the Web</a><ul>
<li><a class="reference internal" href="#part-1-web-scraping">Part 1: Web Scraping</a><ul>
<li><a class="reference internal" href="#html-data">HTML Data</a></li>
<li><a class="reference internal" href="#cleaning-up-the-mess">Cleaning Up the Mess</a></li>
<li><a class="reference internal" href="#getting-webpages">Getting Webpages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-example-scraping-blog-posts">An Example: Scraping Blog Posts</a><ul>
<li><a class="reference internal" href="#fetching-a-page">Fetching a Page</a></li>
<li><a class="reference internal" href="#parsing-html">Parsing HTML</a></li>
<li><a class="reference internal" href="#searching-html">Searching HTML</a></li>
</ul>
</li>
<li><a class="reference internal" href="#going-farther">Going Farther</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Python 401 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2016, Cris Ewing, Nicholas Hunt-Walker.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>